{% extends "base.html.twig" %}
{% import 'macros/layout.html.twig' as layout %}
{% import 'macros/wiki.html.twig' as wiki %}
{% import 'macros/pieChart.html.twig' as pie %}

{% block body %}
    <div class="panel panel-primary">
        <header class="panel-heading">
            <div class="text-center xt-heading-top">
                <a class="back-to-search" href="{{ path('sc') }}">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                    {{ msg('back') }}
                </a>
                {{ wiki.userLink(user, project) }}
                <small>
                    &bull;
                    {{ project.domain }}
                </small>
            </div>
        </header>

        <div class="panel-body xt-panel-body">
            <p class="text-center xt-heading-subtitle">
                {{ wiki.userLogLink(user, project, msg('block-log'), 'block') }}
                &middot;
                <a href="{{ path('EditCounterResult', {project:project.domain, username:user.username}) }}" >{{ msg('tool-ec') }}</a>
                {% if isWMFLabs() %}
                    &middot;
                    <a target="_blank" href="//tools.wmflabs.org/guc/?user={{ user.username }}" >{{ msg('global-contribs') }}</a>
                    &middot;
                    <a target="_blank" href="//tools.wmflabs.org/pageviews/?project={{ project.domain }}&amp;pages=User:{{ user.username }}">{{ msg('pageviews-userpage') }}</a>
                {% endif %}
            </p>

                <div class="col-lg-12 stat-list clearfix">
                    {% for type in data|keys %}
                        {% set innercontent %}
                            {# TODO: Pie chart here#}
                            {% for vote in data[type]|keys %}
                                <H3>{{ vote }}</H3>
                                <table class="table table-striped table-responsive">
                                {% for pagename in data[type][vote]|keys %}
                                    {% set parsedData=data[type][vote][pagename] %}
                                    <tr>
                                        <td>{{ loop.index }}</td>
                                        <td>{{ parsedData.Date }}</td>
                                        <td>(<span class="text-success">{{ parsedData.Support }}</span>, <span class="text-danger">{{ parsedData.Oppose }}</span>, <span class="text-muted">{{ parsedData.Neutral }}</span>)</td>
                                        <td>{{ wiki.pageLinkRaw(pagename, project, parsedData.name) }}</td>
                                    </tr>
                                {% endfor %}
                                </table>
                            {% endfor %}
                        {% endset %}
                        {{ layout.content_block(type, innercontent, "", type, true) }}
                    {% endfor %}
                </div>
        </div>
    </div>
{% endblock %}